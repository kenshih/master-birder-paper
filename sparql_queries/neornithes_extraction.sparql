# SPARQL queries to extract Neornithes taxonomy from Fuseki
# Run these in the Fuseki web interface at http://localhost:3030/ncbitaxon/sparql

# 1. First, check what taxonomic ranks are available
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?rank (COUNT(*) as ?count)
WHERE {
    ?taxon obo:NCBITaxon_rank ?rank .
}
GROUP BY ?rank
ORDER BY DESC(?count)
LIMIT 20

# 2. Get all descendants of Neornithes (NCBITaxon_8825) down to species level
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT DISTINCT ?taxon ?label ?rank
WHERE {
    # Start from Neornithes
    obo:NCBITaxon_8825 obo:NCBITaxon_has_rank ?neornithes_rank .
    
    # Get all descendants using transitive closure
    ?taxon obo:NCBITaxon_has_rank ?rank .
    ?taxon obo:NCBITaxon_has_rank+ obo:NCBITaxon_8825 .
    
    # Only include ranks down to species (exclude subspecies and below)
    FILTER (?rank = obo:NCBITaxon_superclass || 
            ?rank = obo:NCBITaxon_class || 
            ?rank = obo:NCBITaxon_subclass ||
            ?rank = obo:NCBITaxon_superorder ||
            ?rank = obo:NCBITaxon_order ||
            ?rank = obo:NCBITaxon_suborder ||
            ?rank = obo:NCBITaxon_superfamily ||
            ?rank = obo:NCBITaxon_family ||
            ?rank = obo:NCBITaxon_subfamily ||
            ?rank = obo:NCBITaxon_genus ||
            ?rank = obo:NCBITaxon_species)
    
    # Get labels
    OPTIONAL { ?taxon rdfs:label ?label }
}
ORDER BY ?taxon
LIMIT 1000

# 3. Get all triples for Neornithes descendants (for export)
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

CONSTRUCT {
    ?taxon ?predicate ?object .
}
WHERE {
    # Start from Neornithes
    obo:NCBITaxon_8825 obo:NCBITaxon_has_rank ?neornithes_rank .
    
    # Get all descendants
    ?taxon obo:NCBITaxon_has_rank ?rank .
    ?taxon obo:NCBITaxon_has_rank+ obo:NCBITaxon_8825 .
    
    # Only include ranks down to species
    FILTER (?rank = obo:NCBITaxon_superclass || 
            ?rank = obo:NCBITaxon_class || 
            ?rank = obo:NCBITaxon_subclass ||
            ?rank = obo:NCBITaxon_superorder ||
            ?rank = obo:NCBITaxon_order ||
            ?rank = obo:NCBITaxon_suborder ||
            ?rank = obo:NCBITaxon_superfamily ||
            ?rank = obo:NCBITaxon_family ||
            ?rank = obo:NCBITaxon_subfamily ||
            ?rank = obo:NCBITaxon_genus ||
            ?rank = obo:NCBITaxon_species)
    
    # Get all triples for these taxa
    ?taxon ?predicate ?object .
}

# 4. Count Neornithes taxa by rank
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?rank (COUNT(*) as ?count)
WHERE {
    # Start from Neornithes
    obo:NCBITaxon_8825 obo:NCBITaxon_has_rank ?neornithes_rank .
    
    # Get all descendants
    ?taxon obo:NCBITaxon_has_rank ?rank .
    ?taxon obo:NCBITaxon_has_rank+ obo:NCBITaxon_8825 .
    
    # Only include ranks down to species
    FILTER (?rank = obo:NCBITaxon_superclass || 
            ?rank = obo:NCBITaxon_class || 
            ?rank = obo:NCBITaxon_subclass ||
            ?rank = obo:NCBITaxon_superorder ||
            ?rank = obo:NCBITaxon_order ||
            ?rank = obo:NCBITaxon_suborder ||
            ?rank = obo:NCBITaxon_superfamily ||
            ?rank = obo:NCBITaxon_family ||
            ?rank = obo:NCBITaxon_subfamily ||
            ?rank = obo:NCBITaxon_genus ||
            ?rank = obo:NCBITaxon_species)
}
GROUP BY ?rank
ORDER BY DESC(?count)
